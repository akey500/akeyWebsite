<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <style media="screen">
    body {
      margin: 0px;
      padding: 0px;

    background-image: url('SPACE.jpg');
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-size: cover;
    }

    </style>
  </head>

  <body>
    <div id="canvasSpot"></div>

  </body>

  <script type="text/javascript">

    //canvas_width = 1430;
    //canvas_height = 785;

  canvas_width = window.innerWidth;
 canvas_height = window.innerHeight;

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const username = urlParams.get('name');


    cvs = document.createElement("CANVAS");
    cvs.height = canvas_height;
    cvs.width = canvas_width;

    document.getElementById("canvasSpot").append(cvs);

    elem = document.getElementById("canvasSpot");
    elem.append(cvs);
    ctx = cvs.getContext('2d');

    x2 = 715;
    y2 = 732;

    //import rocket picture
    img= new Image();
    img.src= "rocket.png";

    speed = 10


//draw circles
class asteroid {
  constructor(){
    this.x = Math.floor(Math.random() * 1430);
    this.y = 0;
  }


  move(speed){
    this.y = this.y + speed;

    ctx.beginPath();
    ctx.arc(this.x, this.y, 25, 0, 2 * Math.PI, false);
    ctx.fillStyle = 'grey';
    ctx.fill();
    ctx.lineWidth = 5;
    ctx.strokeStyle = 'black';
    ctx.stroke();
  }
}

// creating asteroids
asteroids= [];
for (let i=0; i<3; i++){
  asteroids.push(new asteroid());

}

// dropings asteroids
function addAsteroid(){
  asteroids.push(new asteroid());
}

// how often asteroids drop down
setInterval(addAsteroid, 1000);
setInterval(addAsteroid, 1100);
setInterval(addAsteroid, 1200);
setInterval(addAsteroid, 1300);
setInterval(addAsteroid, 1400);
setInterval(addAsteroid, 1500);
setInterval(addAsteroid, 1600);
setInterval(addAsteroid, 1700);
setInterval(addAsteroid, 1800);
setInterval(addAsteroid, 1900);


// find distance between rocket and asteroids
// x1/y1= rocket x2/y2= asteroids
   function distance(x1, y1){
   d = Math.sqrt( ((x2+27.5-x1+12.5)**2) + ((y2-y1+12.5)**2) );
   return d;
 }

function dead(x1, y1){
    if (distance(x1, y1) <= 30){
      isdead = true;
    }
    return distance (x1, y1);
}

//sending data
function sendData(username, score){
  xhttp = new XMLHttpRequest();
  let url = "./saveData.php?username="+username + "&score="+score;

  console.log(url);

  //NEW
  xhttp.onreadystatechange = function() {
      if (xhttp.readyState == XMLHttpRequest.DONE) {
          console.log(xhttp.responseText);
      }
  }
  //END NEW

  xhttp.open("GET", url, true);
  xhttp.send();

}



isdead = false;



//call animate function
window.requestAnimationFrame(animate);

    //Animation function
    function animate(){
      //clear canvas
      ctx.clearRect(0,0, canvas_width, canvas_height);

      document.addEventListener('keydown', moveBox);

//speeding up the asteroids
      if (asteroids.length>100) {
      speed = 10 + .04*(asteroids.length-100);
    }


// print speed
        //ctx.fillText(speed, 0.5 * canvas_width, 75);

      for (let i=0; i<asteroids.length; i++){
        asteroids[i].move(speed);
        d = dead(asteroids[i].x, asteroids[i].y)
      }

      score = asteroids.length;
        ctx.font = "50px Courier New";
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.fillText(score, 0.95 * canvas_width, 75);
        ctx.fillText(username, 0.05 * canvas_width, 75);


      ctx.drawImage(img, x2, y2, 75, 55);

      if (isdead !== true){
        //Re-run function
        window.requestAnimationFrame(animate);
      }
      else {
        sendData(username, score);

        img= new Image();
        img.src= "explosion.gif";

        ctx.font = "55px Courier New";
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.fillText("you died.", 0.5 * canvas_width, 392.5);

    // print high score at end of game
        ctx.fillText("High Score", 0.5 * canvas_width, 125);
        ctx.fillText(score, 0.5 * canvas_width, 200);
      }
    }

    //keyboard input
    function moveBox(e){
      if (e.key === "ArrowLeft"){
        x2 = x2 - 50;
      }
      if (e.key === "ArrowRight"){
        x2 = x2 + 50;
      }
    }





  </script>



</html>
